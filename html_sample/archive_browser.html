<html>
<head>
	<title>Archive Browser</title>
  <meta charset="UTF-8">
	<script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
  <script>
    
    function loadJs(url, callback){
      var head = document.getElementsByTagName('head')[0];
      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.src = url;
      head.appendChild(script);
      script.onreadystatechange = callback;
      script.onload = callback;

      
    }
  </script>
  <!--script src="meta/init.js"></script-->

  <style>
    img{
      max-width: 300px;
      max-height: 200px;
      margin: 2px;
    }

    .keyword{
      border: 1px solid grey;
      margin: 3px;
      padding: 3px 5px;
      display: inline-block;
    }

    .keyword:hover{
      color: green;
      border: 1px solid green;
    }
  </style>


</head>

<body>
	<div id="search_box">
    <center>
  		<input type="text" name="search" id="search_field" placeholder="Enter keywords! " style="width: 90%; height:30px;"/> 
      <input type="button" value="X" id="clear_search"/>
  		<input type="button" value="Search!" id="search_btn" style="width: 30%; height:40px; margin: 10px 0px;"/>
    </center>
  </div>

  <div id="keywords"></div>


	<div id="pictures" style="margin-top: 30px;"></div>

  <script>
    $(window).load(function(){
      keywordlist = new Array();
      loadJs("meta/list/keywordlist.js", function(){
        for(var keyword in keywordlist){
          $("#keywords").append('<div class="keyword">' + keywordlist[keyword] + '</div>');
        }

        $(".keyword").bind('click', function(){
          console.log($(this).text() + "clicked");
          $("#search_field").val($("#search_field").val() + " " + $(this).text());
        });
      });
    });

    $("#search_btn").click(function(event){
      event.preventDefault();
      var searchArray = $("#search_field").val().trim().split(" ");
      $("#pictures").html("");
      meta = new Object();
      loadKeyword(0, searchArray);
    });

    $("#clear_search").click(function(){
      $("#search_field").val("");
    });

    function loadKeyword(i, array){
      if(i < array.length){
        loadJs("meta/" + array[i] + ".js", function(){
          console.log(array[i] + " loaded");
          loadKeyword(i+1, array);
        });
      }
      else{
        for(key in meta){
          keywordStr = "";
          for(k in meta[key]){
            keywordStr += meta[key][k] + " ";
          }
          $("#pictures").append('<img src="' + key + '" keywords="' + keywordStr.trim() + '">');
        }
      }
    }

    function addPicture(picUrl, keyword){
      if(typeof meta[picUrl] === "undefined"){
        meta[picUrl] = new Array();
      }
      meta[picUrl].push(keyword);
    }

    
  </script>
</body>
</html>