<html>
<head>
	<title>Archive Browser</title>
  <meta charset="UTF-8">
	<script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
  <script>
    
    function loadJs(url, callback){
      var head = document.getElementsByTagName('head')[0];
      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.src = url;
      head.appendChild(script);
      script.onreadystatechange = callback;
      script.onload = callback;
    }

  </script>
  <style>
    img{
      max-width: 300px;
      max-height: 200px;
      margin: 2px;
    }

    .keyword{
      border: 1px solid grey;
      margin: 3px;
      padding: 3px 5px;
      display: inline-block;
    }

    .keyword:hover{
      color: green;
      border: 1px solid green;
    }
  </style>


</head>

<body>
	<div id="search_box">
    <center>
      <form method="GET">
    		<input type="text" name="search" id="search_field" placeholder="Enter keywords! " style="width: 60%; height:30px;"/> 
        <input type="button" value="X" id="clear_search" style="width: 10%; height:30px;"/>
    		<input type="submit" value="Search!" id="search_btn" style="width: 40%; height:30px; margin: 10px 0px;"/>
        
      </from>
    </center>
  </div>

  <div id="keywords"></div>
	<div id="pictures" style="margin-top: 30px;"></div>

  <script>
    getURLParameter = function (sParam){
        var sPageURL = window.location.search.substring(1);
        var sURLVariables = sPageURL.split('&');
        for (var i = 0; i < sURLVariables.length; i++){
            var sParameterName = sURLVariables[i].split('=');
            if (sParameterName[0] == sParam){
                return decodeURIComponent(sParameterName[1]).split('+').join(' ').trim();
            }
        }
    }

    $(window).load(function(){
      searchStr = getURLParameter("search");
      $("#search_field").val(searchStr.trim());
      var searchArray = searchStr.trim().split(" ");
      $("#pictures").html("");
      meta = new Object();
      loadKeyword(0, searchArray);


      $("#clear_search").click(function(){
        $("#search_field").val("");
      });


      keywordlist = new Array();
      loadJs("meta/list/keywordlist.js", function(){
        keywordlist.sort();
        for(var keyword in keywordlist){
          $("#keywords").append('<div class="keyword">' + keywordlist[keyword] + '</div>');
        }

        $(".keyword").bind('click', function(){
          console.log($(this).text() + "clicked");
          $("#search_field").val($("#search_field").val() + " " + $(this).text());
        });
      });
    });


      

    function loadKeyword(i, array){
      //TODO AND - OR szűrés a kulcsszavakon
      if(i < array.length){
        loadJs("meta/" + array[i] + ".js", function(){
          console.log(array[i] + " loaded");
          loadKeyword(i+1, array);
        });
      }
      else{
        for(key in meta){
          keywordStr = "";
          for(k in meta[key]){
            keywordStr += meta[key][k] + " ";
          }
          $("#pictures").append('<a href="' + key + '"><img src="thumbnails/' + key +'?rnd=' + parseInt(Math.random()*1000) + '" keywords="' + keywordStr.trim() + '"></a>');
        }
        meta = null;
      }
    }

    function addPicture(picUrl, keyword){
      if(typeof meta[picUrl] === "undefined"){
        meta[picUrl] = new Array();
      }
      meta[picUrl].push(keyword);
    }

    
  </script>
</body>
</html>